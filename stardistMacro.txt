// Ask for the input folder
input = getDirectory("Choose the Input Folder");

//Ask for the output folder
output = getDirectory("Choose the Output Folder")

processFolder(input);

// function to scan folders/subfolders/files to find files with correct suffix
function processFolder(input) {
	list = getFileList(input);
	list = Array.sort(list);
	for (i = 0; i < list.length; i++) {

	// Do the processing here by adding your own code.
	// Leave the print statements until things work, then remove them.
	//@ File(style="directory") outputDirectory
open(input + list[i]);
//run("Properties...", "channels=1 slices=1 frames=1 pixel_width=0.6473791 pixel_height=0.6473791 voxel_depth=1.0000000 global");
myDir=getDirectory("image");
name1=getTitle();
name2=File.nameWithoutExtension;
run("Duplicate...", "title=[Raw Image]");
run("Command From Macro", "command=[de.csbdresden.stardist.StarDist2D], args=['input':'Raw Image', 'modelChoice':'Versatile (fluorescent nuclei)', 'normalizeInput':'true', 'percentileBottom':'1.0', 'percentileTop':'99.8', 'probThresh':'0.5', 'nmsThresh':'0.4', 'outputType':'Both', 'nTiles':'1', 'excludeBoundary':'2', 'roiPosition':'Automatic', 'verbose':'false', 'showCsbdeepProgress':'false', 'showProbAndDist':'false'], process=[false]");
selectWindow("Label Image");
rename(name1);
run("Set Measurements...", "area area_fraction limit display redirect=None decimal=3");
roiManager("Measure");
saveAs("Tiff", output+name2+"StarDist"+".tif");
roiManager("delete");
close("ROI Manager");
run("Clear Results");
close("Results");
close();
close();
close();
	print("Processing: " + input + list[i]);
	print("Saving to: " + output);
}